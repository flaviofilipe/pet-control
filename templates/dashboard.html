<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f2ea;
            color: #4b4b4b;
        }
        .bg-terracotta { background-color: #e57373; }
        .text-terracotta { color: #e57373; }
        .bg-sage { background-color: #5c6e5e; }
        .text-sage { color: #5c6e5e; }
        
        /* Sidebar styles */
        .sidebar {
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
        }
        .sidebar.open {
            transform: translateX(0);
        }
        .sidebar-overlay {
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease-in-out;
        }
        .sidebar-overlay.open {
            opacity: 1;
            visibility: visible;
        }
        
        @media (min-width: 1024px) {
            .sidebar {
                transform: translateX(0);
            }
            .sidebar-overlay {
                display: none;
            }
        }
    </style>
</head>
<body class="flex flex-col h-screen">
    <!-- Header com Menu Sanduíche -->
    <header class="bg-sage text-white shadow-md p-4 z-50 flex-shrink-0">
        <nav class="container mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <!-- Botão do menu sanduíche (mobile) -->
                <button id="sidebar-toggle" class="lg:hidden text-white hover:text-gray-200 transition-colors duration-200">
                    <i class="fas fa-bars text-xl"></i>
                </button>
                
                <!-- Foto e nome do usuário -->
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center text-xl font-bold text-gray-400 overflow-hidden">
                        {% if user_info.photo %}
                            <img src="{{ user_info.photo }}" alt="Foto de Perfil" class="w-full h-full object-cover rounded-full">
                        {% else %}
                            <span>{{ user_info.name[0] | upper if user_info.name else '?' }}</span>
                        {% endif %}
                    </div>
                    <div class="hidden sm:block">
                        <h1 class="text-lg font-semibold">Bem-vindo, {{ user_info.profile.name | default('Usuário') }}</h1>
                        <p class="text-sm opacity-90">{{ user_info.email | default('') }}</p>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center space-x-4">
                <a href="/profile" class="text-white hover:text-gray-200 transition-colors duration-200">
                    <i class="fas fa-user-circle mr-2"></i> Perfil
                </a>
                <a href="/logout" class="bg-[#8b4513] hover:bg-[#a0522d] text-white px-4 py-2 rounded-md font-medium transition-colors duration-200">
                    Sair
                </a>
            </div>
        </nav>
    </header>

    <!-- Container principal com sidebar e conteúdo -->
    <div class="flex flex-1 overflow-hidden">
        <!-- Sidebar Overlay (mobile) -->
        <div id="sidebar-overlay" class="sidebar-overlay fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden"></div>

        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar fixed left-0 top-0 h-full w-64 bg-white shadow-lg z-50 lg:relative lg:translate-x-0 lg:h-auto lg:flex-shrink-0">
            <div class="h-full flex flex-col">
                <!-- Logo/Header do Sidebar -->
                <div class="p-6 flex-shrink-0">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-sage rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fas fa-paw text-2xl text-white"></i>
                        </div>
                        <h2 class="text-lg font-bold text-sage">Patas Digitais</h2>
                    </div>
                </div>

                <!-- Menu de Navegação -->
                <nav class="flex-1 px-6 space-y-2">
                    <!-- Dashboard -->
                    <a href="/dashboard" class="flex items-center px-4 py-3 text-gray-700 bg-gray-100 rounded-lg font-medium">
                        <i class="fas fa-home mr-3 text-sage"></i>
                        Dashboard
                    </a>

                    <!-- Seção Conheça -->
                    <div class="mt-6">
                        <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3 px-4">
                            Conheça
                        </h3>
                        
                        <a href="/vacinas" class="flex items-center px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors duration-200">
                            <i class="fas fa-syringe mr-3 text-terracotta"></i>
                            Vacinas
                        </a>
                        
                        <a href="/ectoparasitas" class="flex items-center px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors duration-200">
                            <i class="fas fa-bug mr-3 text-sage"></i>
                            Ectoparasitas
                        </a>
                        
                        <a href="/vermifugos" class="flex items-center px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors duration-200">
                            <i class="fas fa-pills mr-3 text-purple-600"></i>
                            Vermífugos
                        </a>
                    </div>

                    <!-- Seção Gerenciar -->
                    <div class="mt-6">
                        <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3 px-4">
                            Gerenciar
                        </h3>
                        
                        <a href="/pets/form" class="flex items-center px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors duration-200">
                            <i class="fas fa-plus-circle mr-3 text-green-600"></i>
                            Adicionar Pet
                        </a>
                        
                        <a href="/profile" class="flex items-center px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors duration-200">
                            <i class="fas fa-user-edit mr-3 text-blue-600"></i>
                            Editar Perfil
                        </a>
                    </div>
                </nav>
            </div>
        </aside>

        <!-- Conteúdo Principal -->
        <main class="flex-1 overflow-y-auto bg-gray-50">
            <div class="p-6">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-sage">Seus Pets</h2>
                    <p class="text-gray-600">Gerencie a saúde e o bem-estar dos seus companheiros aqui.</p>
                </div>

                <!-- Barra de Pesquisa e Filtros -->
                <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                    <div class="flex flex-col lg:flex-row gap-4">
                        <!-- Campo de Pesquisa por Nome -->
                        <div class="flex-1">
                            <label for="search-name" class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-search mr-2 text-terracotta"></i>Pesquisar por Nome
                            </label>
                            <input type="text" 
                                   id="search-name" 
                                   placeholder="Digite o nome do pet..."
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-terracotta focus:border-transparent transition-all duration-200">
                        </div>
                        
                        <!-- Filtro por Tipo -->
                        <div class="lg:w-48">
                            <label for="filter-type" class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-filter mr-2 text-terracotta"></i>Tipo
                            </label>
                            <select id="filter-type" 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-terracotta focus:border-transparent transition-all duration-200">
                                <option value="">Todos os tipos</option>
                                <option value="dog">Cachorro</option>
                                <option value="cat">Gato</option>
                            </select>
                        </div>
                        
                        <!-- Filtro por Pedigree -->
                        <div class="lg:w-48">
                            <label for="filter-pedigree" class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-id-card-alt mr-2 text-terracotta"></i>Pedigree
                            </label>
                            <select id="filter-pedigree" 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-terracotta focus:border-transparent transition-all duration-200">
                                <option value="">Todos</option>
                                <option value="with">Com Pedigree</option>
                                <option value="without">Sem Pedigree</option>
                            </select>
                        </div>
                        
                        <!-- Botão Limpar Filtros -->
                        <div class="flex items-end">
                            <button id="clear-filters" 
                                    class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors duration-200 flex items-center">
                                <i class="fas fa-times mr-2"></i>Limpar
                            </button>
                        </div>
                    </div>
                </div>

        <!-- Seção de Pets -->
        <div id="pets-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% if not pets %}
                <div class="col-span-full text-center py-12">
                    <i class="fas fa-paw text-6xl text-gray-400 mb-4"></i>
                    <p class="text-gray-600 text-lg">Nenhum pet cadastrado. Adicione o seu primeiro!</p>
                </div>
            {% else %}
                {% for pet in pets %}
                    <a href="/pets/{{ pet._id }}/profile" 
                       class="pet-card block bg-white rounded-xl shadow-md overflow-hidden p-6 hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1"
                       data-name="{{ pet.name | lower }}"
                       data-type="{{ pet.pet_type }}"
                       data-pedigree="{{ 'with' if pet.pedigree_number else 'without' }}">
                        <div class="flex items-center justify-between mb-4">
                           <h3 class="text-xl font-bold text-[#5c6e5e]">{{ pet.name }}</h3>
                           <span class="text-sm text-gray-500">ID: {{ pet.nickname }}</span>
                        </div>
                        
                        <!-- Foto do pet -->
                        <div class="mb-4 flex justify-center">
                            {% if pet.photo %}
                                <img src="/uploads/{{ pet._id }}/thumb_{{ pet.photo.filename }}" 
                                     alt="Foto de {{ pet.name }}" 
                                     class="w-24 h-24 rounded-full object-cover border-4 border-[#e57373] shadow-lg">
                            {% else %}
                                <div class="w-24 h-24 rounded-full bg-gray-200 flex items-center justify-center border-4 border-gray-300">
                                    <i class="fas fa-{{ 'dog' if pet.pet_type == 'dog' else 'cat' }} text-3xl text-gray-400"></i>
                                </div>
                            {% endif %}
                        </div>
                        
                        <p class="text-gray-600 text-sm mb-4 text-center">{{ pet.breed }}</p>
                        <div class="space-y-2">
                            <div class="flex items-center text-gray-700">
                                <i class="fas fa-id-card-alt mr-2 text-terracotta"></i>
                                <span>Pedigree: {{ pet.pedigree_number or 'Não informado' }}</span>
                            </div>
                            <div class="flex items-center text-gray-700">
                                <i class="fas fa-birthday-cake mr-2 text-terracotta"></i>
                                <span>Nascimento: {{ pet.birth_date }}</span>
                            </div>
                            <div class="flex items-center text-gray-700">
                                <i class="fas fa-{{ 'dog' if pet.pet_type == 'dog' else 'cat' }} mr-2 text-terracotta"></i>
                                <span>Tipo: {{ pet.pet_type }}</span>
                            </div>
                        </div>
                    </a>
                {% endfor %}
            {% endif %}
        </div>
        
                <div class="text-center mt-8">
                    <a href="/pets/form" class="bg-terracotta hover:bg-red-600 text-white font-bold py-3 px-6 rounded-md shadow-lg transition-transform transform hover:scale-105 duration-300">
                        <i class="fas fa-plus-circle mr-2"></i> Adicionar Novo Pet
                    </a>
                </div>
            </div>
        </main>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-200 text-center text-gray-600 p-4 flex-shrink-0">
        <p>&copy; 2024 Patas Digitais. Todos os direitos reservados.</p>
    </footer>

    <!-- JavaScript para o Sidebar -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            
            // Toggle sidebar
            sidebarToggle.addEventListener('click', function() {
                sidebar.classList.toggle('open');
                sidebarOverlay.classList.toggle('open');
            });
            
            // Fechar sidebar ao clicar no overlay
            sidebarOverlay.addEventListener('click', function() {
                sidebar.classList.remove('open');
                sidebarOverlay.classList.remove('open');
            });
            
            // Fechar sidebar ao redimensionar para desktop
            window.addEventListener('resize', function() {
                if (window.innerWidth >= 1024) {
                    sidebar.classList.remove('open');
                    sidebarOverlay.classList.remove('open');
                }
            });
            
            // Funcionalidade de pesquisa e filtros
            const searchInput = document.getElementById('search-name');
            const typeFilter = document.getElementById('filter-type');
            const pedigreeFilter = document.getElementById('filter-pedigree');
            const clearButton = document.getElementById('clear-filters');
            const petCards = document.querySelectorAll('.pet-card');
            
            function filterPets() {
                const searchTerm = searchInput.value.toLowerCase().trim();
                const selectedType = typeFilter.value;
                const selectedPedigree = pedigreeFilter.value;
                
                let visibleCount = 0;
                
                petCards.forEach(card => {
                    const petName = card.getAttribute('data-name');
                    const petType = card.getAttribute('data-type');
                    const petPedigree = card.getAttribute('data-pedigree');
                    
                    let showCard = true;
                    
                    // Filtro por nome
                    if (searchTerm && !petName.includes(searchTerm)) {
                        showCard = false;
                    }
                    
                    // Filtro por tipo
                    if (selectedType && petType !== selectedType) {
                        showCard = false;
                    }
                    
                    // Filtro por pedigree
                    if (selectedPedigree && petPedigree !== selectedPedigree) {
                        showCard = false;
                    }
                    
                    if (showCard) {
                        card.style.display = 'block';
                        visibleCount++;
                    } else {
                        card.style.display = 'none';
                    }
                });
                
                // Mostra mensagem se nenhum pet for encontrado
                const noResultsMessage = document.getElementById('no-results-message');
                if (visibleCount === 0 && petCards.length > 0) {
                    if (!noResultsMessage) {
                        const grid = document.getElementById('pets-grid');
                        const message = document.createElement('div');
                        message.id = 'no-results-message';
                        message.className = 'col-span-full text-center py-12';
                        message.innerHTML = `
                            <i class="fas fa-search text-6xl text-gray-400 mb-4"></i>
                            <p class="text-gray-600 text-lg">Nenhum pet encontrado com os filtros aplicados.</p>
                            <button onclick="clearFilters()" class="mt-4 text-terracotta hover:text-red-600 font-medium">
                                <i class="fas fa-times mr-2"></i>Limpar filtros
                            </button>
                        `;
                        grid.appendChild(message);
                    }
                } else if (noResultsMessage) {
                    noResultsMessage.remove();
                }
            }
            
            function clearFilters() {
                searchInput.value = '';
                typeFilter.value = '';
                pedigreeFilter.value = '';
                filterPets();
            }
            
            // Event listeners
            searchInput.addEventListener('input', filterPets);
            typeFilter.addEventListener('change', filterPets);
            pedigreeFilter.addEventListener('change', filterPets);
            clearButton.addEventListener('click', clearFilters);
            
            // Função global para o botão de limpar filtros na mensagem
            window.clearFilters = clearFilters;
        });
    </script>
</body>
</html>
